# justfile-global
# Auto-generated by airis-workspace
# Docker-First Development Workflow

# Auto-detect project name from directory
project := `basename $(pwd)`
workspace_svc := env_var_or_default("WORKSPACE_SVC", "workspace")

# Colors
green := '\033[0;32m'
yellow := '\033[1;33m'
blue := '\033[0;34m'
nc := '\033[0m'

# Default recipe (show help)
default:
    @just --list

# Show project configuration
info:
    @echo ""
    @echo "{{blue}}üìã Project Configuration{{nc}}"
    @echo "{{blue}}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ{{nc}}"
    @echo "  Project Name:      {{green}}{{project}}{{nc}}"
    @echo "  Workspace Service: {{green}}{{workspace_svc}}{{nc}}"
    @echo "  Current Directory: {{green}}$(pwd){{nc}}"
    @echo ""

# Start Docker Compose services
up:
    @echo "{{green}}Starting Docker Compose services...{{nc}}"
    docker compose up -d
    @echo "{{green}}‚úÖ Services started{{nc}}"

# Stop Docker Compose services
down:
    @echo "{{yellow}}Stopping Docker Compose services...{{nc}}"
    docker compose down --remove-orphans
    @echo "{{green}}‚úÖ Services stopped{{nc}}"

# Restart services
restart: down up

# Install dependencies in container (keeps Mac clean)
install:
    @echo "{{blue}}Installing dependencies in container...{{nc}}"
    @if ! docker compose ps -q {{workspace_svc}} >/dev/null 2>&1 || [ -z "$(docker compose ps -q {{workspace_svc}})" ]; then \
      echo "{{yellow}}‚ÑπÔ∏è  {{workspace_svc}} not running, starting...{{nc}}"; \
      docker compose up -d; \
    fi
    docker compose exec {{workspace_svc}} pnpm install
    @echo "{{green}}‚úÖ Dependencies installed in container{{nc}}"

# Enter workspace shell
workspace:
    docker compose exec -it {{workspace_svc}} sh

# Alias for workspace
sh: workspace

# Enter workspace bash shell
bash:
    docker compose exec -it {{workspace_svc}} bash

# Execute command in workspace
exec *args:
    docker compose exec {{workspace_svc}} {{args}}

# Build project
build:
    docker compose exec {{workspace_svc}} pnpm build

# Run tests
test:
    docker compose exec {{workspace_svc}} pnpm test

# Run linter
lint:
    docker compose exec {{workspace_svc}} pnpm lint

# Type check (TypeScript)
typecheck:
    docker compose exec {{workspace_svc}} pnpm typecheck

# Clean local artifacts (safe, no container removal)
clean:
    @echo "{{yellow}}üßπ Cleaning local artifacts for {{project}}...{{nc}}"
    rm -rf ./node_modules ./dist ./.next ./build ./.turbo
    find . -name ".DS_Store" -type f -delete 2>/dev/null || true
    @echo "{{green}}‚úÖ Local artifacts cleaned{{nc}}"

# Complete cleanup (removes Docker volumes)
clean-all: clean
    @echo "{{yellow}}üßπ Removing Docker volumes...{{nc}}"
    docker compose down -v --remove-orphans
    @echo "{{green}}‚úÖ Complete cleanup done{{nc}}"

# Show logs
logs:
    docker compose logs -f

# Show container status
ps:
    docker compose ps

# Guard: Prevent direct package manager usage on host
[private]
guard tool:
    @echo "‚ùå ERROR: '{{tool}}' commands must run inside Docker workspace"
    @echo "   This project follows Docker-First architecture"
    @echo ""
    @echo "   To run {{tool}} commands:"
    @echo "     1. Enter workspace: just workspace"
    @echo "     2. Run command:     {{tool}} <your-command>"
    @echo ""
    @echo "   Or use: just install | just build | just test"
    @exit 1

# Fake targets to catch direct usage (Docker-First enforcement)
pnpm *args:
    @just guard pnpm

npm *args:
    @just guard npm

yarn *args:
    @just guard yarn
