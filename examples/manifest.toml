# manifest.toml - Docker-First Monorepo Configuration
# Single source of truth for workspace management
# Generated files: package.json, pnpm-workspace.yaml, docker-compose.yml

version = 1
mode = "docker-first"
app = []

# =============================================================================
# Project Metadata (optional, for Cargo.toml/Homebrew generation)
# =============================================================================
[project]
id = ""
binary_name = ""
version = ""
description = ""
authors = []
license = ""
homepage = ""
repository = ""
keywords = []
categories = []
rust_edition = ""

# =============================================================================
# Workspace Configuration
# =============================================================================
[workspace]
name = "my-monorepo"                  # Your project name
package_manager = "pnpm@10.23.0"      # Package manager version
service = "workspace"                 # Docker service name
image = "node:24-bookworm"            # Base Docker image
workdir = "/app"                      # Container working directory
volumes = [
    # Named volumes for build artifacts (prevents host pollution)
    "node_modules:/app/node_modules",
    "next_build:/app/.next",
    "dist_build:/app/dist",
    "build_output:/app/build",
    "out_export:/app/out",
    "turbo_cache:/app/.turbo",
    "swc_cache:/app/.swc",
    "cache_dir:/app/.cache",
]

[workspace.clean]
dirs = [
    ".next",
    "dist",
    "build",
    "out",
    ".swc",
    ".cache",
    ".pnpm-store",
    ".pnpm-global",
    "target",
]
recursive = ["node_modules"]

# =============================================================================
# Dependency Catalog (version policies)
# Use "latest" | "lts" | "^X.Y.Z" format
# =============================================================================
[catalog]
"next" = "latest"
"react" = "latest"
"react-dom" = "latest"
"tailwindcss" = "latest"
"typescript" = "latest"
"@types/node" = "latest"
"tsup" = "latest"
"vitest" = "latest"

# =============================================================================
# Workspaces (legacy, use [packages.workspaces] instead)
# =============================================================================
[workspaces]
apps = []
libs = []

# =============================================================================
# Development Environment
# =============================================================================
[dev]
# supabase = ["supabase/docker-compose.yml"]
# traefik = "traefik/docker-compose.yml"

[[dev.urls.infra]]
name = "Traefik Dashboard"
url = "http://localhost:8080"

[[dev.urls.apps]]
name = "Dashboard"
url = "http://localhost:3000"

# =============================================================================
# Applications
# Supported types: nextjs, node, rust, python, hono
# =============================================================================
[apps.dashboard]
path = "apps/dashboard"
type = "nextjs"

[apps.api]
path = "apps/api"
type = "hono"

# Example: Rust app with local build (for GPU support)
# [apps.ml-service]
# path = "apps/ml-service"
# type = "rust"
# runtime = "local"  # Build on host instead of Docker

# =============================================================================
# Libraries
# =============================================================================
[libs.ui]
path = "libs/ui"

[libs.utils]
path = "libs/utils"

# =============================================================================
# Docker Configuration
# =============================================================================
[docker]
baseImage = ""
workdir = ""

[service]

# =============================================================================
# Rules (validation commands)
# =============================================================================
[rule.verify]
commands = [
    "airis lint",
    "airis test",
]

[rule.ci]
commands = [
    "airis lint",
    "airis test",
    "airis typecheck",
]

# =============================================================================
# Packages (pnpm workspace configuration)
# =============================================================================
[packages]
workspaces = [
    "apps/*",
    "libs/*",
]
app = []

# Shared dependency versions (pnpm catalog)
[packages.catalog]
next = "latest"
react = "latest"
react-dom = "latest"
typescript = "latest"
"@types/node" = "latest"
"@types/react" = "latest"
"@types/react-dom" = "latest"
tailwindcss = "latest"
"@tailwindcss/postcss" = "latest"
postcss = "latest"
autoprefixer = "latest"
clsx = "latest"
tailwind-merge = "latest"
lucide-react = "latest"
zod = "latest"
tsup = "latest"
tsx = "latest"
vitest = "latest"
"@vitest/coverage-v8" = "latest"
eslint = "latest"

[packages.root.dependencies]

[packages.root.devDependencies]
"@biomejs/biome" = "2.3.6"
"@types/node" = "catalog:"
"@types/react" = "catalog:"
"@types/react-dom" = "catalog:"
"@vitest/coverage-v8" = "catalog:"
eslint = "catalog:"
tailwindcss = "catalog:"
tsup = "catalog:"
tsx = "catalog:"
typescript = "catalog:"
vitest = "catalog:"
zod = "catalog:"

[packages.root.optionalDependencies]

[packages.root.scripts]
test = "vitest"
"test:ci" = "vitest run"
"test:watch" = "vitest watch"
"test:coverage" = "vitest run --coverage"
build = "pnpm -r build"
dev = "pnpm -r dev"
lint = "biome check ."
"lint:fix" = "biome check --write ."
typecheck = "pnpm -r typecheck"
format = "biome format --write ."

[packages.root.engines]
node = ">=24.0.0"
pnpm = ">=10.15.0"

[packages.root.pnpm]
onlyBuiltDependencies = ["esbuild"]

[packages.root.pnpm.overrides]
react = "19.1.1"
react-dom = "19.1.1"

[packages.root.pnpm.peerDependencyRules]
ignoreMissing = [
    "@types/*",
    "typescript",
    "react",
    "react-dom",
]

[packages.root.pnpm.peerDependencyRules.allowedVersions]
react = "19"
react-dom = "19"

# =============================================================================
# Guards (Docker-First enforcement)
# =============================================================================
[guards]
deny = [
    "npm",
    "yarn",
    "npx",
]
forbid = []
danger = []

[guards.wrap]
pnpm = "docker compose exec workspace pnpm"

[guards.deny_with_message]
"docker run" = "Use 'airis up' instead. Direct docker run is not allowed."
docker-compose = "Use 'docker compose' (with space) or 'airis up' instead."

# =============================================================================
# Orchestration (Docker networking)
# =============================================================================
[orchestration]

[orchestration.networks]
# proxy = "traefik-public"  # External proxy network
default_external = false

# =============================================================================
# Commands (airis run <task>)
# =============================================================================
[commands]
shell = "docker compose exec workspace bash"
install = "docker compose exec workspace pnpm install"
dev = "docker compose exec workspace pnpm run dev"
build = "docker compose exec workspace pnpm build"
test = "docker compose exec workspace pnpm test"
lint = "docker compose exec workspace pnpm lint"
format = "docker compose exec workspace pnpm format"
typecheck = "docker compose exec workspace pnpm typecheck"

# =============================================================================
# Remap (LLM command translation)
# =============================================================================
[remap]
# "npm install" = "airis install"

# =============================================================================
# Versioning
# =============================================================================
[versioning]
strategy = "manual"  # manual | conventional-commits | auto
source = "0.1.0"

# =============================================================================
# Documentation
# =============================================================================
[docs]
targets = []
mode = "warn"

# =============================================================================
# CI/CD
# =============================================================================
[ci]
enabled = false
auto_version = false

[ci.auto_merge]
enabled = false
from = "develop"
to = "main"

# =============================================================================
# Templates (airis new)
# =============================================================================
[templates.api]
[templates.web]
[templates.worker]
[templates.cli]
[templates.lib]
[templates.edge]
[templates.supabase-trigger]
[templates.supabase-realtime]

# =============================================================================
# Runtime Aliases
# =============================================================================
[runtimes.alias]
