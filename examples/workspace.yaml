# workspace.yaml - Example Configuration
# Single source of truth for airis-workspace

version: 1
name: my-monorepo
mode: docker-first  # strict | docker-first | hybrid

# Dependency catalog (pnpm-compatible)
# Reference in package.json as "dep": "catalog:"
catalog:
  # Frontend
  react: 19.0.0
  next: 15.4.0
  typescript: 5.8.0
  tailwindcss: 4.0.0

  # Backend
  hono: 4.0.0
  drizzle-orm: 0.36.0

  # Shared
  zod: 3.24.0

  # Dev Dependencies
  vitest: 2.0.0
  playwright: 1.50.0
  eslint: 9.0.0

# Workspace structure
workspaces:
  apps:
    - dashboard
    - api
  libs:
    - ui
    - db
    - utils

# App-specific configuration
apps:
  dashboard:
    type: nextjs
    port: 3000
    runtime: docker
    env:
      - NEXT_PUBLIC_API_URL
      - DATABASE_URL

  api:
    type: hono
    port: 8080
    runtime: docker
    env:
      - DATABASE_URL
      - JWT_SECRET

  duplicate-finder:
    type: rust
    runtime: local  # Build locally for GPU support
    reason: "Apple Silicon GPU (Metal) acceleration"
    cargo:
      features:
        - metal
        - gpu-accelerated

# Docker configuration
docker:
  baseImage: node:22-alpine
  workdir: /app
  volumes:
    - node_modules
    - .next
  networks:
    - default

# Rules enforcement
rules:
  no-host-install: error      # Block pnpm/npm/yarn on host
  catalog-only: warn          # Warn when adding non-catalog deps
  root-devdeps: error         # DevDeps must be in root only
  no-env-local: error         # Block .env.local files

# Just configuration
just:
  template: templates/justfile-global
  generateTarget: justfile

# Environment variable validation
env:
  required:
    - DATABASE_URL
  optional:
    - SENTRY_DSN
    - ANALYTICS_ID

  # Validation rules
  validation:
    DATABASE_URL:
      pattern: ^postgresql://
      description: "Must be a valid PostgreSQL connection string"

    PORT:
      type: number
      range: [3000, 9000]

# LLM context generation
llm:
  contextFile: .workspace/llm-context.md
  errorVerbosity: high
  includeRules: true
